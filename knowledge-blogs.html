<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Blogs - Nivezo</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --bg-primary: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success-color: #22c55e;
            --bg-secondary: #f8fafc;
            --border-color: #e2e8f0;
            --hover-color: #f1f5f9;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .navbar {
            background-color: var(--bg-primary);
            padding: 1rem 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-pie-chart {
            width: 24px;
            height: 24px;
            border: 3px solid var(--primary-color);
            border-radius: 50%;
            border-top-color: var(--primary-dark);
            border-right-color: transparent;
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: var(--text-primary);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .page-header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .loading-container {
            text-align: center;
            padding: 3rem;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 2rem 0;
            text-align: center;
        }

        .blogs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .blog-card {
            background: var(--bg-primary);
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            height: fit-content;
        }

        .blog-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border-color: var(--primary-color);
        }

        .blog-card-header {
            padding: 1.5rem 1.5rem 1rem;
        }

        .blog-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .blog-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .blog-tag {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .blog-preview {
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .blog-card-footer {
            padding: 0 1.5rem 1.5rem;
        }

        .read-more-btn {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 0.9rem;
        }

        .read-more-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }

        .no-blogs-message {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .no-blogs-message i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 2rem;
            }
            
            .blogs-grid {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
            
            .container {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="/" class="nav-brand">
                <div class="nav-pie-chart"></div>
                <div>Nivezo</div>
            </a>
            <div class="nav-actions">
                <a href="/" class="btn btn-secondary">
                    <i class="fas fa-home"></i> Back to Home
                </a>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1><i class="fas fa-blog"></i> Knowledge Blogs</h1>
            <p>Stay updated with the latest insights on personal finance, investing, and wealth building</p>
        </div>

        <!-- Loading State -->
        <div id="loadingContainer" class="loading-container">
            <div class="loading-spinner"></div>
            <p>Loading latest blog posts...</p>
        </div>

        <!-- Error State -->
        <div id="errorContainer" class="error-message" style="display: none;">
            <i class="fas fa-exclamation-triangle"></i>
            <p id="errorMessage">Failed to load blog posts. Please try again later.</p>
            <details style="margin-top: 1rem;">
                <summary style="cursor: pointer; color: #dc2626;">Show technical details</summary>
                <pre id="errorDetails" style="margin-top: 0.5rem; font-size: 0.8rem; background: #fef2f2; padding: 1rem; border-radius: 0.25rem; overflow: auto;"></pre>
            </details>
        </div>

        <!-- Blogs Grid -->
        <div id="blogsGrid" class="blogs-grid" style="display: none;">
            <!-- Blog cards will be dynamically inserted here -->
        </div>

        <!-- No Blogs State -->
        <div id="noBlogsContainer" class="no-blogs-message" style="display: none;">
            <i class="fas fa-newspaper"></i>
            <h3>No blog posts available</h3>
            <p>Check back soon for new content!</p>
        </div>
    </div>

    <script>
        // Fetch and display blog posts from Notion via Netlify function
        async function fetchBlogPosts() {
            const loadingContainer = document.getElementById('loadingContainer');
            const errorContainer = document.getElementById('errorContainer');
            const blogsGrid = document.getElementById('blogsGrid');
            const noBlogsContainer = document.getElementById('noBlogsContainer');

            try {
                console.log('Fetching blog posts from Notion...');
                
                const response = await fetch('/.netlify/functions/getBlogs');
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: 'Unknown error' }));
                    throw new Error(`HTTP ${response.status}: ${errorData.message || errorData.error || 'Unknown error'}`);
                }
                
                const data = await response.json();
                console.log('Blog data received:', data);
                
                // Hide loading
                loadingContainer.style.display = 'none';
                
                if (!data || data.length === 0) {
                    noBlogsContainer.style.display = 'block';
                    return;
                }
                
                // Display blogs
                displayBlogPosts(data);
                blogsGrid.style.display = 'grid';
                
            } catch (error) {
                console.error('Error fetching blog posts:', error);
                loadingContainer.style.display = 'none';
                
                // Show detailed error information
                const errorMessage = document.getElementById('errorMessage');
                const errorDetails = document.getElementById('errorDetails');
                
                errorMessage.textContent = 'Failed to load blog posts. Please try again later.';
                errorDetails.textContent = `Error: ${error.message}\n\nThis might be due to:\n1. Network connectivity issues\n2. Server configuration problems\n3. Notion API access issues\n\nPlease check the browser's Network tab for more details.`;
                
                errorContainer.style.display = 'block';
            }
        }

        function displayBlogPosts(posts) {
            const blogsGrid = document.getElementById('blogsGrid');
            blogsGrid.innerHTML = '';

            posts.forEach(post => {
                const blogCard = createBlogCard(post);
                blogsGrid.appendChild(blogCard);
            });
        }

        function createBlogCard(post) {
            const card = document.createElement('div');
            card.className = 'blog-card';

            // Extract data from Notion API response format
            const title = extractTitle(post);
            const tags = extractTags(post);
            const preview = extractPreview(post);
            
            card.innerHTML = `
                <div class="blog-card-header">
                    <h3 class="blog-title">${escapeHtml(title)}</h3>
                    ${tags.length > 0 ? `
                        <div class="blog-tags">
                            ${tags.map(tag => `<span class="blog-tag">${escapeHtml(tag)}</span>`).join('')}
                        </div>
                    ` : ''}
                    <p class="blog-preview">${escapeHtml(preview)}</p>
                </div>
                <div class="blog-card-footer">
                    <button class="read-more-btn" onclick="handleReadMore('${escapeHtml(title)}')">
                        <i class="fas fa-arrow-right"></i> Read More
                    </button>
                </div>
            `;

            return card;
        }

        function extractTitle(post) {
            // Extract title from Notion API response
            if (post.properties && post.properties.Title && post.properties.Title.title) {
                return post.properties.Title.title.map(t => t.plain_text).join('');
            }
            if (post.properties && post.properties.Name && post.properties.Name.title) {
                return post.properties.Name.title.map(t => t.plain_text).join('');
            }
            // Try other common title field names
            const titleFields = ['title', 'name', 'Title', 'Name'];
            for (const field of titleFields) {
                if (post.properties && post.properties[field] && post.properties[field].title) {
                    return post.properties[field].title.map(t => t.plain_text).join('');
                }
            }
            return 'Untitled Post';
        }

        function extractTags(post) {
            // Extract tags from Notion API response
            if (post.properties) {
                const tagFields = ['Tags', 'Category', 'categories', 'tags'];
                for (const field of tagFields) {
                    if (post.properties[field]) {
                        if (post.properties[field].multi_select) {
                            return post.properties[field].multi_select.map(tag => tag.name);
                        }
                        if (post.properties[field].select && post.properties[field].select.name) {
                            return [post.properties[field].select.name];
                        }
                    }
                }
            }
            return [];
        }

        function extractPreview(post) {
            // Extract preview from Notion API response
            if (post.properties) {
                const previewFields = ['Preview', 'Description', 'Summary', 'Content', 'preview', 'description', 'summary', 'content'];
                
                for (const field of previewFields) {
                    if (post.properties[field]) {
                        // Handle rich text fields
                        if (post.properties[field].rich_text && post.properties[field].rich_text.length > 0) {
                            const text = post.properties[field].rich_text.map(t => t.plain_text).join('').trim();
                            if (text.length > 0) {
                                return text.length > 200 ? text.substring(0, 200) + '...' : text;
                            }
                        }
                        // Handle text fields
                        if (post.properties[field].text && post.properties[field].text.length > 0) {
                            const text = post.properties[field].text.map(t => t.plain_text).join('').trim();
                            if (text.length > 0) {
                                return text.length > 200 ? text.substring(0, 200) + '...' : text;
                            }
                        }
                    }
                }
            }
            
            return 'Click to read more about this topic...';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function handleReadMore(title) {
            // Placeholder for read more functionality
            alert(`Read More functionality for "${title}" will be implemented soon!`);
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            fetchBlogPosts();
        });
    </script>
</body>
</html> 