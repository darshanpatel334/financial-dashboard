<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Freedom Score - Nivezo</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand">
                <div class="nav-pie-chart"></div>
                <div>Nivezo</div>
            </a>
            <div class="user-info">
                <span class="user-email" id="userEmail"></span>
                <button class="btn btn-secondary" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1><i class="fas fa-trophy"></i> Financial Freedom Score</h1>
            <p>Calculate how many years your current wealth can sustain your lifestyle</p>
        </div>

        <!-- Page Description -->
        <div class="page-description" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                About This Section
            </h3>
            <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                Your FF Score shows how close you are to financial independence. It tells you how many years your current wealth can support your lifestyle if your income stopped today.
            </p>
            <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                This is a powerful way to check whether you are saving enough or need to adjust your investments. The higher your FF Score, the closer you are to freedom from financial pressure.
            </p>
            <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                Do not get confused or demotivated if your Financial Freedom (FF) score is below 10 or even 5. It doesn't mean you're not rich or don't have enough wealth. It simply means that, for now, you still need to keep earning to maintain your lifestyle. Always look at your FF score relative to your age. A lower score is normal in the early years of your career. The goal is to gradually grow it over time as your savings and investments build up.
            </p>
            <div style="background: #e0f2fe; border-radius: 8px; padding: 1rem; border-left: 4px solid var(--primary-color);">
                <strong style="color: var(--primary-color);">How to go about it:</strong>
                <span style="color: #0c4a6e;"> Once you fill your net worth and expense data, Nivezo will calculate your score. Monitor it over time and try to increase it steadily by reducing expenses or increasing savings.</span>
            </div>
        </div>

        <!-- Instruction Box -->
        <div class="instruction-box">
            <h3><i class="fas fa-info-circle"></i> How FF Score Works</h3>
            <p>Your FF Score shows how many years your current net worth can sustain your expenses, considering asset growth and inflation. A score of 25+ years indicates strong financial independence.</p>
        </div>

        <!-- Current Data Summary -->
        <div class="summary-grid">
            <div class="summary-card networth">
                <h3>Net Worth</h3>
                <div class="summary-amount networth" id="currentNetWorth">â‚¹0</div>
                <small>Current liquid assets</small>
            </div>
            <div class="summary-card liabilities">
                <h3>Annual Expenses</h3>
                <div class="summary-amount negative" id="currentExpenses">â‚¹0</div>
                <small>Total yearly spending</small>
            </div>
            <div class="summary-card assets">
                <h3>Asset Growth Rate</h3>
                <div class="summary-amount positive" id="currentGrowthRate">8%</div>
                <small>Expected annual returns</small>
            </div>
        </div>

        <!-- FF Score Display -->
        <div class="score-display">
            <div class="score-number" id="ffScore">0</div>
            <div class="score-label" id="ffScoreLabel">Years of Financial Freedom</div>
            <div style="margin-top: 1rem;">
                <span id="ffScoreEmoji" style="font-size: 2rem;">ðŸ”´</span>
                <div id="ffScoreLevel" style="font-size: 1.1rem; margin-top: 0.5rem; font-weight: 600;">Calculating...</div>
            </div>
        </div>

        <!-- Settings Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-sliders-h"></i> Calculation Settings
                </h2>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="assetGrowthRate">Weighted Average Expected Returns (% annually)</label>
                    <input type="number" id="assetGrowthRate" value="8" step="0.1" min="0" max="30" readonly style="background: #f8fafc;">
                    <small class="text-secondary">Auto-calculated from your net worth data</small>
                </div>
                <div class="form-group">
                    <label for="inflationRate">Inflation Rate (% annually)</label>
                    <input type="number" id="inflationRate" value="6" step="0.1" min="0" max="20" onchange="calculateFFScore()">
                    <small class="text-secondary">Historical average in India: 4-6%</small>
                </div>
            </div>
        </div>

        <!-- Scenario Analysis -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-chart-bar"></i> Scenario Analysis
                </h2>
            </div>
            
            <div class="grid-3">
                <div class="card">
                    <div class="card-body text-center">
                        <h4>Conservative</h4>
                        <div class="score-number" id="conservativeScore">0</div>
                        <p class="text-secondary">6% growth, 6% inflation</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body text-center">
                        <h4>Moderate</h4>
                        <div class="score-number" id="moderateScore">0</div>
                        <p class="text-secondary">10% growth, 6% inflation</p>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body text-center">
                        <h4>Aggressive</h4>
                        <div class="score-number" id="aggressiveScore">0</div>
                        <p class="text-secondary">15% growth, 6% inflation</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Educational Insights -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-graduation-cap"></i> Educational Insights
                </h2>
                <small class="text-secondary">Learn about factors that impact financial freedom</small>
            </div>
            
            <div id="suggestions">
                <!-- Educational insights will be populated here -->
            </div>
        </div>

        <!-- Progress Visualization -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-chart-line"></i> Financial Independence Journey
                </h2>
            </div>
            
            <div class="progress-visualization">
                <div class="progress-bar">
                    <div class="progress-fill" id="ffProgress" style="width: 0%"></div>
                </div>
                <div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.9rem;">
                    <span>Financially Insecure</span>
                    <span>Getting There</span>
                    <span>Financial Freedom</span>
                </div>
            </div>
        </div>

        <!-- What-If Calculator -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-calculator"></i> What-If Calculator
                </h2>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="additionalSavings">Additional Monthly Savings (â‚¹)</label>
                    <input type="number" id="additionalSavings" value="0" onchange="calculateWhatIf()">
                </div>
                <div class="form-group">
                    <label for="expenseReduction">Monthly Expense Reduction (â‚¹)</label>
                    <input type="number" id="expenseReduction" value="0" onchange="calculateWhatIf()">
                </div>
            </div>
            
            <div class="card" style="margin-top: 1rem;">
                <div class="card-body text-center">
                    <h4>Improved FF Score</h4>
                    <div class="score-number" id="improvedScore">0</div>
                    <p class="text-secondary">With your changes</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button type="button" class="nav-btn btn-secondary" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Back: Expenses
            </button>
            <button type="button" class="nav-btn btn-primary" onclick="goNext()">
                Next: Insurance <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- Status Message -->
    <div id="status" class="status-message" style="display: none;"></div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-auth-compat.js"></script>
    <script src="auth.js"></script>
    <script src="common.js"></script>
    <script type="module">
        import { saveFormData, fetchFormData } from './firestoreService.js';
        import { auth } from './firebase.js';
        import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js';
        
        // Initialize Firebase integration
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // Load existing data from Firestore
                const savedData = await fetchFormData('ff_score');
                if (savedData && Object.keys(savedData).length > 0) {
                    // Restore form data
                    window.loadFFScoreFromFirestore = () => savedData;
                    if (typeof window.loadFFScoreData === 'function') {
                        window.loadFFScoreData(savedData);
                    }
                }
            }
        });
        
        // Override save function to use Firestore
        const originalSaveData = window.saveFFScoreData;
        window.saveFFScoreData = async function() {
            if (typeof originalSaveData === 'function') {
                const data = originalSaveData();
                if (data) {
                    try {
                        await saveFormData('ff_score', data);
                        localStorage.setItem('ffScoreData', JSON.stringify(data));
                    } catch (error) {
                        console.error('Error saving to Firestore:', error);
                        localStorage.setItem('ffScoreData', JSON.stringify(data));
                    }
                }
                return data;
            }
        };
    </script>
    <script src="ff-score.js"></script>
    
    <script>
        // Setup navigation
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof setupPageNavigation === 'function') {
                setupPageNavigation(5); // 5 = FF Score page
            }
        });
    </script>
    
    <!-- Include Chat Widget -->
    <script>
        fetch('chat-widget.html')
            .then(response => response.text())
            .then(html => {
                document.body.insertAdjacentHTML('beforeend', html);
            })
            .catch(error => console.log('Chat widget not available'));
    </script>
</body>
</html> 