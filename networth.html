<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Net Worth - Nivezo</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --bg-primary: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success-color: #22c55e;
            --bg-secondary: #f8fafc;
            --border-color: #e2e8f0;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .navbar {
            background-color: var(--bg-primary);
            padding: 1rem 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .instruction-box {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            border: 1px solid #0ea5e9;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .instruction-box h3 {
            color: #0369a1;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .summary-card {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .summary-card.assets {
            border-left: 4px solid var(--success-color);
        }

        .summary-card.liabilities {
            border-left: 4px solid var(--danger-color);
        }

        .summary-card.networth {
            border-left: 4px solid var(--primary-color);
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }

        .summary-amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .summary-amount.positive {
            color: var(--success-color);
        }

        .summary-amount.negative {
            color: var(--danger-color);
        }

        .summary-amount.networth {
            color: var(--primary-color);
        }

        .section-card {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .add-item-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .category-group {
            margin-bottom: 2rem;
        }

        .category-header {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .category-total {
            font-weight: 700;
            color: var(--primary-color);
        }

        .asset-item {
            background: #fafafa;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 1rem;
            align-items: center;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            font-size: 0.9rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .amount-display {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .delete-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 0.375rem;
            border-radius: 0.375rem;
            cursor: pointer;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .nav-btn {
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            font-size: 1rem;
            min-width: 150px;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: var(--text-primary);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-email {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .status-message {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .status-message.success {
            background-color: var(--success-color);
        }

        .status-message.error {
            background-color: var(--danger-color);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .asset-item {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .navigation {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand">
                <div class="nav-pie-chart"></div>
                <div>Nivezo</div>
            </a>
            <div class="user-info">
                <span class="user-email" id="userEmail"></span>
                <button class="btn btn-secondary" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1><i class="fas fa-chart-line"></i> Net Worth Analysis</h1>
            <p>Track your assets and liabilities to calculate your true net worth</p>
        </div>

        <!-- Page Description -->
        <div class="page-description" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                About This Section
            </h3>
            <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                Net worth is a snapshot of your overall financial health. It is calculated as everything you own (assets) minus everything you owe (liabilities). This one number tells you if you are moving in the right direction financially.
            </p>
            <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                If your net worth grows year after year, it means your wealth is compounding. If it's declining, it's a signal that expenses or debt may be outpacing your income or savings.
            </p>
            <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                <strong>Important:</strong> Try to avoid adding your own house, ornaments, vehicles, or any other assets which you're using on a daily basis and not looking to sell for profit. Focus on investment assets that generate income or can be easily liquidated.
            </p>
            <div style="background: #e0f2fe; border-radius: 8px; padding: 1rem; border-left: 4px solid var(--primary-color);">
                <strong style="color: var(--primary-color);">How to go about it:</strong>
                <span style="color: #0c4a6e;"> Add details about your bank balance, investments, gold, property, and vehicles. Then include your loans and credit dues. This gives you the clearest possible view of your actual financial position.</span>
            </div>
        </div>

        <!-- Instruction Box -->
        <div class="instruction-box">
            <h3><i class="fas fa-info-circle"></i> Important Note</h3>
            <p>% Yield represents the annual income you generate or expect to generate from each asset, excluding asset appreciation. For example, rental income from real estate, dividends from equity, or interest from fixed deposits.</p>
        </div>

        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card assets">
                <h3>Total Assets</h3>
                <div class="summary-amount positive" id="totalAssets">₹0</div>
                <small>Excluding occupied house & ornaments</small>
            </div>
            <div class="summary-card liabilities">
                <h3>Total Liabilities</h3>
                <div class="summary-amount negative" id="totalLiabilities">₹0</div>
                <small>Remaining principal amounts</small>
            </div>
            <div class="summary-card networth">
                <h3>Net Worth</h3>
                <div class="summary-amount networth" id="netWorth">₹0</div>
                <small>Assets - Liabilities</small>
            </div>
        </div>

        <!-- Assets Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-building"></i> Assets
                </h2>
            </div>

            <!-- Real Estate -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">🏠 Real Estate</span>
                    <span class="category-total" id="realEstateTotal">₹0</span>
                </div>
                <div id="realEstateItems">
                    <!-- Real estate items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('realEstate', 'Real Estate')">
                    <i class="fas fa-plus"></i> Add Real Estate
                </button>
            </div>

            <!-- Cash & Bank -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">💰 Cash & Bank</span>
                    <span class="category-total" id="cashTotal">₹0</span>
                </div>
                <div id="cashItems">
                    <!-- Cash items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('cash', 'Cash & Bank')">
                    <i class="fas fa-plus"></i> Add Cash/Bank Account
                </button>
            </div>

            <!-- Equity Investments -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">📈 Equity Investments (Direct Equity & Equity Mutual Funds)</span>
                    <span class="category-total" id="equityTotal">₹0</span>
                </div>
                <div id="equityItems">
                    <!-- Equity items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('equity', 'Equity')">
                    <i class="fas fa-plus"></i> Add Equity Investment
                </button>
            </div>

            <!-- Fixed Income -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">🏦 Fixed Income</span>
                    <span class="category-total" id="fixedIncomeTotal">₹0</span>
                </div>
                <div id="fixedIncomeItems">
                    <!-- Fixed income items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('fixedIncome', 'Fixed Income')">
                    <i class="fas fa-plus"></i> Add Fixed Income
                </button>
            </div>

            <!-- Other Assets -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">💎 Other Assets</span>
                    <span class="category-total" id="otherAssetsTotal">₹0</span>
                </div>
                <div id="otherAssetsItems">
                    <!-- Other assets items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('otherAssets', 'Other Asset')">
                    <i class="fas fa-plus"></i> Add Other Asset
                </button>
            </div>
        </div>

        <!-- Liabilities Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-credit-card"></i> Liabilities
                </h2>
            </div>

            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">💳 Loans & Debts</span>
                    <span class="category-total" id="liabilitiesTotal">₹0</span>
                </div>
                <div id="liabilityItems">
                    <!-- Liability items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addLiabilityItem()">
                    <i class="fas fa-plus"></i> Add Liability
                </button>
            </div>
        </div>

        <!-- Recurring Investments Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-sync-alt"></i> Recurring Investments & Savings
                </h2>
                <small class="text-secondary">Track your regular monthly investments and savings</small>
            </div>

            <!-- Monthly Recurring Summary -->
            <div class="summary-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr; margin-bottom: 2rem;">
                <div class="summary-card assets">
                    <h3>Total SIP</h3>
                    <div class="summary-amount positive" id="totalSIP">₹0</div>
                    <small>Monthly SIP amount</small>
                </div>
                <div class="summary-card networth">
                    <h3>Total RD/FD</h3>
                    <div class="summary-amount networth" id="totalRD">₹0</div>
                    <small>Monthly recurring deposits</small>
                </div>
                <div class="summary-card liabilities">
                    <h3>Other Savings</h3>
                    <div class="summary-amount negative" id="totalOtherSavings">₹0</div>
                    <small>Monthly other schemes</small>
                </div>
                <div class="summary-card">
                    <h3>Total Monthly</h3>
                    <div class="summary-amount" id="totalRecurringSavings">₹0</div>
                    <small>Combined monthly savings</small>
                </div>
            </div>

            <!-- Mutual Fund SIP -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">📈 Mutual Fund SIP</span>
                    <span class="category-total" id="sipTotal">₹0/month</span>
                </div>
                <div id="sipItems">
                    <!-- SIP items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addRecurringItem('sip', 'Mutual Fund SIP')">
                    <i class="fas fa-plus"></i> Add SIP
                </button>
            </div>

            <!-- Recurring FD/RD -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">🏦 Recurring Deposits</span>
                    <span class="category-total" id="rdTotal">₹0/month</span>
                </div>
                <div id="rdItems">
                    <!-- RD items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addRecurringItem('rd', 'Recurring Deposit')">
                    <i class="fas fa-plus"></i> Add Recurring Deposit
                </button>
            </div>

            <!-- Other Savings Schemes -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">💰 Other Savings Schemes</span>
                    <span class="category-total" id="otherSavingsTotal">₹0/month</span>
                </div>
                <div class="instruction-box">
                    <p><strong>Examples:</strong> PF, PPF, ELSS, NSC, Life Insurance Premiums, Gold SIP, or any regular investment</p>
                </div>
                <div id="otherSavingsItems">
                    <!-- Other savings items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addRecurringItem('otherSavings', 'Savings Scheme')">
                    <i class="fas fa-plus"></i> Add Savings Scheme
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button type="button" class="nav-btn btn-secondary" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Back: Personal Info
            </button>
            <button type="button" class="nav-btn btn-primary" onclick="goNext()">
                Next: Income Analysis <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- Status Message -->
    <div id="status" class="status-message" style="display: none;"></div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-auth-compat.js"></script>
    <script src="auth.js"></script>
    <script src="common.js"></script>

    <script>
        let assetCount = 0;
        let liabilityCount = 0;

        // Initialize page when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    const userEmailElement = document.getElementById('userEmail');
                    if (userEmailElement) {
                        // Use the getUserDisplayName function from auth.js
                        if (typeof getUserDisplayName === 'function') {
                            userEmailElement.textContent = getUserDisplayName();
                        } else {
                            // Fallback to extracting first name from email
                            const emailPart = user.email.split('@')[0];
                            const namePart = emailPart.replace(/[0-9]/g, '').split('.')[0];
                            userEmailElement.textContent = namePart.charAt(0).toUpperCase() + namePart.slice(1);
                        }
                    }
                    
                    // Load data with a small delay to ensure DOM is ready
                    setTimeout(() => {
                        loadNetWorthData();
                        calculateTotals();
                        calculateRecurringTotals();
                    }, 100);
                    
                    // Setup navigation system
                    if (typeof setupPageNavigation === 'function') {
                        setupPageNavigation(2); // 2 = Net Worth page
                    }
                } else {
                    window.location.href = 'index.html';
                }
            });
            
            // Save data when user is about to leave the page
            window.addEventListener('beforeunload', function() {
                saveNetWorthData();
            });
        });

        function showStatus(message, isError = false) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status-message ${isError ? 'error' : 'success'}`;
            statusElement.style.display = 'block';
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        function numberToWords(num) {
            if (num === 0) return "Zero";
            
            const ones = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
            const teens = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
            const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
            
            function convertHundreds(n) {
                let result = "";
                if (n >= 100) {
                    result += ones[Math.floor(n / 100)] + " Hundred ";
                    n %= 100;
                }
                if (n >= 20) {
                    result += tens[Math.floor(n / 10)] + " ";
                    n %= 10;
                }
                if (n >= 10) {
                    result += teens[n - 10] + " ";
                } else if (n > 0) {
                    result += ones[n] + " ";
                }
                return result;
            }
            
            if (num >= 10000000) { // Crores
                return convertHundreds(Math.floor(num / 10000000)) + "Crore " + numberToWords(num % 10000000);
            } else if (num >= 100000) { // Lakhs
                return convertHundreds(Math.floor(num / 100000)) + "Lakh " + numberToWords(num % 100000);
            } else if (num >= 1000) { // Thousands
                return convertHundreds(Math.floor(num / 1000)) + "Thousand " + numberToWords(num % 1000);
            } else {
                return convertHundreds(num);
            }
        }

        function addAssetItem(category, type) {
            assetCount++;
            const container = document.getElementById(category + 'Items');
            const assetItem = document.createElement('div');
            assetItem.className = 'asset-item';
            
            let fieldsHTML = '';
            
            if (category === 'realEstate') {
                fieldsHTML = `
                    <div class="form-group">
                        <label>${type} Name</label>
                        <input type="text" placeholder="Enter property name" onchange="calculateTotals()">
                    </div>
                    <div class="form-group">
                        <label>Current Price per Sq Ft (₹)</label>
                        <input type="number" placeholder="0" onchange="calculateRealEstateValue(this)">
                    </div>
                    <div class="form-group">
                        <label>Total Area (Sq Ft)</label>
                        <input type="number" placeholder="0" onchange="calculateRealEstateValue(this)">
                    </div>
                    <div class="form-group">
                        <label>Current Value (₹)</label>
                        <input type="number" placeholder="0" onchange="calculateTotals(); updateWords(this)" readonly style="background: #f8fafc;">
                        <div class="amount-display"></div>
                    </div>
                    <div class="form-group">
                        <label>Monthly Rental (₹)</label>
                        <input type="number" placeholder="0" onchange="calculateRentalYield(this)">
                    </div>
                    <div class="form-group">
                        <label>Rental Frequency</label>
                        <select onchange="calculateRentalYield(this)">
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="semi-annually">Semi-Annually</option>
                            <option value="annually">Annually</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Annual Yield %</label>
                        <input type="number" step="0.1" placeholder="0" readonly style="background: #f8fafc;">
                    </div>
                `;
            } else if (category === 'equity') {
                fieldsHTML = `
                    <div class="form-group">
                        <label>${type} Name</label>
                        <input type="text" placeholder="Enter equity name" onchange="calculateTotals()">
                    </div>
                    <div class="form-group">
                        <label>Current Value (₹)</label>
                        <input type="number" placeholder="0" onchange="calculateTotals(); updateWords(this)">
                        <div class="amount-display"></div>
                    </div>
                    <div class="form-group">
                        <label>% Dividend Yield</label>
                        <input type="number" step="0.1" placeholder="0" onchange="calculateTotals()">
                    </div>
                `;
            } else if (category === 'fixedIncome') {
                fieldsHTML = `
                    <div class="form-group">
                        <label>${type} Name</label>
                        <input type="text" placeholder="Enter fixed income name" onchange="calculateTotals()">
                    </div>
                    <div class="form-group">
                        <label>Current Value (₹)</label>
                        <input type="number" placeholder="0" onchange="calculateTotals(); updateWords(this)">
                        <div class="amount-display"></div>
                    </div>
                    <div class="form-group">
                        <label>% Annual Interest</label>
                        <input type="number" step="0.1" placeholder="0" onchange="calculateTotals()">
                    </div>
                `;
            } else if (category === 'cash') {
                fieldsHTML = `
                    <div class="form-group">
                        <label>${type} Name</label>
                        <input type="text" placeholder="Enter account name" onchange="calculateTotals()">
                    </div>
                    <div class="form-group">
                        <label>Current Value (₹)</label>
                        <input type="number" placeholder="0" onchange="calculateTotals(); updateWords(this)">
                        <div class="amount-display"></div>
                    </div>
                    <div class="form-group">
                        <label>% Annual Interest</label>
                        <input type="number" step="0.1" placeholder="0" onchange="calculateTotals()">
                    </div>
                `;
            } else {
                fieldsHTML = `
                    <div class="form-group">
                        <label>${type} Name</label>
                        <input type="text" placeholder="Enter asset name" onchange="calculateTotals()">
                    </div>
                    <div class="form-group">
                        <label>Current Value (₹)</label>
                        <input type="number" placeholder="0" onchange="calculateTotals(); updateWords(this)">
                        <div class="amount-display"></div>
                    </div>
                    <div class="form-group">
                        <label>% Annual Return</label>
                        <input type="number" step="0.1" placeholder="0" onchange="calculateTotals()">
                    </div>
                `;
            }
            
            assetItem.innerHTML = fieldsHTML + `
                <button class="delete-btn" onclick="removeItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            
            container.appendChild(assetItem);
            // Immediate save when item is added
            setTimeout(() => saveNetWorthData(), 100);
        }

        function addLiabilityItem() {
            liabilityCount++;
            const container = document.getElementById('liabilityItems');
            const liabilityItem = document.createElement('div');
            liabilityItem.className = 'asset-item';
            liabilityItem.innerHTML = `
                <div class="form-group">
                    <label>Loan Type</label>
                    <select onchange="calculateTotals()">
                        <option value="">Select Type</option>
                        <option value="home">Home Loan</option>
                        <option value="car">Car Loan</option>
                        <option value="education">Education Loan</option>
                        <option value="personal">Personal Loan</option>
                        <option value="credit">Credit Card</option>
                        <option value="business">Business Loan</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Remaining Amount (₹)</label>
                    <input type="number" placeholder="0" onchange="calculateTotals(); updateWords(this)">
                    <div class="amount-display"></div>
                </div>
                <div class="form-group">
                    <label>Remaining Tenure (Months)</label>
                    <input type="number" placeholder="0" onchange="calculateTotals()">
                </div>
                <button class="delete-btn" onclick="removeItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(liabilityItem);
            // Immediate save when liability is added
            setTimeout(() => saveNetWorthData(), 100);
        }

        function removeItem(button) {
            button.closest('.asset-item').remove();
            calculateTotals();
            // Immediate save when item is removed
            setTimeout(() => saveNetWorthData(), 100);
        }

        function updateWords(input) {
            const value = parseFloat(input.value) || 0;
            const wordsDiv = input.nextElementSibling;
            if (wordsDiv && wordsDiv.classList.contains('amount-display')) {
                wordsDiv.textContent = value > 0 ? numberToWords(value) : '';
            }
        }

        function calculateTotals() {
            let totalAssets = 0;
            let totalLiabilities = 0;
            let liquidAssets = 0;
            
            // Calculate category totals
            const categories = ['realEstate', 'cash', 'equity', 'fixedIncome', 'otherAssets'];
            categories.forEach(category => {
                let categoryTotal = 0;
                const items = document.querySelectorAll(`#${category}Items .asset-item`);
                items.forEach(item => {
                    let value = 0;
                    
                    if (category === 'realEstate') {
                        // For real estate, value is in the 4th input (Current Value) - use all inputs, not just number type
                        const inputs = item.querySelectorAll('input');
                        value = parseFloat(inputs[3]?.value) || 0;
                    } else {
                        // For other categories, value is in the 2nd input (Current Value)
                        const inputs = item.querySelectorAll('input');
                        value = parseFloat(inputs[1]?.value) || 0;
                    }
                    
                    categoryTotal += value;
                    
                    // Real estate and other assets (like occupied house) are illiquid
                    // Cash and equity/fixed income are liquid
                    if (category !== 'realEstate' && category !== 'otherAssets') {
                        liquidAssets += value;
                    }
                });
                
                // Update category total display
                const categoryTotalElement = document.getElementById(category + 'Total');
                if (categoryTotalElement) {
                    categoryTotalElement.textContent = `₹${categoryTotal.toLocaleString('en-IN')}`;
                }
                
                // Add to total assets
                totalAssets += categoryTotal;
            });

            // Calculate liabilities
            const liabilityItems = document.querySelectorAll('#liabilityItems .asset-item');
            liabilityItems.forEach(item => {
                const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
                totalLiabilities += value;
            });

            // Update totals display
            document.getElementById('totalAssets').textContent = `₹${totalAssets.toLocaleString('en-IN')}`;
            document.getElementById('totalLiabilities').textContent = `₹${totalLiabilities.toLocaleString('en-IN')}`;
            document.getElementById('liabilitiesTotal').textContent = `₹${totalLiabilities.toLocaleString('en-IN')}`;
            
            const netWorth = totalAssets - totalLiabilities;
            const liquidNetWorth = liquidAssets - totalLiabilities;
            
            document.getElementById('netWorth').textContent = `₹${netWorth.toLocaleString('en-IN')}`;
            
            // Display liquid net worth if element exists
            const liquidNetWorthElement = document.getElementById('liquidNetWorth');
            if (liquidNetWorthElement) {
                liquidNetWorthElement.textContent = `₹${liquidNetWorth.toLocaleString('en-IN')}`;
            }

            // Auto-save and recalculate asset income
            setTimeout(() => {
                saveNetWorthData();
                calculateAssetIncome();
            }, 500); // Reduced delay for faster saving
        }

        function saveNetWorthData() {
            const data = {
                assets: {},
                liabilities: [],
                recurringInvestments: {
                    sip: [],
                    rd: [],
                    otherSavings: []
                },
                totals: {
                    totalAssets: parseFloat(document.getElementById('totalAssets').textContent.replace(/[₹,]/g, '')) || 0,
                    totalLiabilities: parseFloat(document.getElementById('totalLiabilities').textContent.replace(/[₹,]/g, '')) || 0,
                    netWorth: parseFloat(document.getElementById('netWorth').textContent.replace(/[₹,]/g, '')) || 0,
                    totalRecurringSavings: parseFloat(document.getElementById('totalRecurringSavings').textContent.replace(/[₹,]/g, '')) || 0
                }
            };

            // Calculate liquid assets (excluding real estate and other assets)
            let liquidAssets = 0;
            const liquidCategories = ['cash', 'equity', 'fixedIncome'];
            
            // Save assets by category
            const categories = ['realEstate', 'cash', 'equity', 'fixedIncome', 'otherAssets'];
            categories.forEach(category => {
                data.assets[category] = [];
                const items = document.querySelectorAll(`#${category}Items .asset-item`);
                items.forEach(item => {
                    const inputs = item.querySelectorAll('input');
                    const select = item.querySelector('select');
                    
                    if (category === 'realEstate' && inputs.length >= 7) {
                        const assetValue = parseFloat(inputs[3].value) || 0;
                        data.assets[category].push({
                            name: inputs[0].value,
                            pricePerSqFt: parseFloat(inputs[1].value) || 0,
                            totalArea: parseFloat(inputs[2].value) || 0,
                            value: assetValue,
                            rentalAmount: parseFloat(inputs[4].value) || 0,
                            rentalFrequency: select?.value || 'monthly',
                            yield: parseFloat(inputs[6].value) || 0
                        });
                        
                        // Add to liquid assets if it's a liquid category
                        if (liquidCategories.includes(category)) {
                            liquidAssets += assetValue;
                        }
                    } else if (inputs.length >= 3) {
                        const assetValue = parseFloat(inputs[1].value) || 0;
                        data.assets[category].push({
                            name: inputs[0].value,
                            value: assetValue,
                            yield: parseFloat(inputs[2].value) || 0
                        });
                        
                        // Add to liquid assets if it's a liquid category
                        if (liquidCategories.includes(category)) {
                            liquidAssets += assetValue;
                        }
                    }
                });
            });

            // Save liabilities
            const liabilityItems = document.querySelectorAll('#liabilityItems .asset-item');
            liabilityItems.forEach(item => {
                const select = item.querySelector('select');
                const inputs = item.querySelectorAll('input');
                if (inputs.length >= 2) {
                    data.liabilities.push({
                        type: select.value,
                        amount: parseFloat(inputs[0].value) || 0,
                        tenure: parseFloat(inputs[1].value) || 0
                    });
                }
            });

            // Save recurring investments
            const recurringCategories = ['sip', 'rd', 'otherSavings'];
            recurringCategories.forEach(category => {
                const items = document.querySelectorAll(`#${category}Items .asset-item`);
                items.forEach(item => {
                    const inputs = item.querySelectorAll('input');
                    const select = item.querySelector('select');
                    if (inputs.length >= 2) {
                        data.recurringInvestments[category].push({
                            name: inputs[0].value,
                            amount: parseFloat(inputs[1].value) || 0,
                            frequency: select.value
                        });
                    }
                });
            });

            // Add liquid net worth to totals
            data.totals.liquidNetWorth = liquidAssets - data.totals.totalLiabilities;

            // Save to localStorage with error handling
            try {
                localStorage.setItem('netWorthData', JSON.stringify(data));
                console.log('Net worth data saved successfully');
            } catch (error) {
                console.error('Error saving net worth data:', error);
                showStatus('Error saving data. Please try again.', true);
            }
        }

        function loadNetWorthData() {
            const savedData = localStorage.getItem('netWorthData');
            console.log('Loading net worth data:', savedData ? 'Data found' : 'No data found');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    console.log('Parsed data:', data);
                
                // Load assets
                Object.keys(data.assets || {}).forEach(category => {
                    data.assets[category].forEach(asset => {
                        addAssetItem(category, category === 'realEstate' ? 'Real Estate' : 
                                   category === 'cash' ? 'Cash & Bank' :
                                   category === 'equity' ? 'Equity' : 
                                   category === 'fixedIncome' ? 'Fixed Income' : 'Other Asset');
                        
                        const lastItem = document.querySelector(`#${category}Items .asset-item:last-child`);
                        const inputs = lastItem.querySelectorAll('input');
                        const select = lastItem.querySelector('select');
                        
                        if (category === 'realEstate') {
                            inputs[0].value = asset.name || '';
                            inputs[1].value = asset.pricePerSqFt || 0;
                            inputs[2].value = asset.totalArea || 0;
                            inputs[3].value = asset.value || 0;
                            inputs[4].value = asset.rentalAmount || 0;
                            if (select) select.value = asset.rentalFrequency || 'monthly';
                            inputs[6].value = asset.yield || 0;
                            updateWords(inputs[3]);
                        } else {
                            inputs[0].value = asset.name || '';
                            inputs[1].value = asset.value || 0;
                            inputs[2].value = asset.yield || 0;
                            updateWords(inputs[1]);
                        }
                    });
                });

                // Load liabilities
                (data.liabilities || []).forEach(liability => {
                    addLiabilityItem();
                    const lastItem = document.querySelector('#liabilityItems .asset-item:last-child');
                    const select = lastItem.querySelector('select');
                    const inputs = lastItem.querySelectorAll('input');
                    select.value = liability.type;
                    inputs[0].value = liability.amount;
                    inputs[1].value = liability.tenure;
                    updateWords(inputs[0]);
                });

                // Load recurring investments
                const recurringData = data.recurringInvestments || {};
                Object.keys(recurringData).forEach(category => {
                    if (recurringData[category]) {
                        recurringData[category].forEach(item => {
                            const categoryName = category === 'sip' ? 'Mutual Fund SIP' : 
                                                category === 'rd' ? 'Recurring Deposit' : 'Savings Scheme';
                            addRecurringItem(category, categoryName);
                            
                            const lastItem = document.querySelector(`#${category}Items .asset-item:last-child`);
                            const inputs = lastItem.querySelectorAll('input');
                            const select = lastItem.querySelector('select');
                            inputs[0].value = item.name || '';
                            inputs[1].value = item.amount || 0;
                            select.value = item.frequency || 'monthly';
                        });
                    }
                });

                calculateTotals();
                calculateRecurringTotals();
                } catch (error) {
                    console.error('Error loading net worth data:', error);
                    showStatus('Error loading saved data.', true);
                }
            }
        }

        function goBack() {
            window.location.href = 'personal-info.html';
        }

        // Recurring investments functions
        let recurringCount = 0;

        function addRecurringItem(category, type) {
            recurringCount++;
            const container = document.getElementById(category + 'Items');
            const recurringItem = document.createElement('div');
            recurringItem.className = 'asset-item';
            recurringItem.innerHTML = `
                <div class="form-group">
                    <label>${type} Name/Scheme</label>
                    <input type="text" placeholder="Enter scheme name" onchange="calculateRecurringTotals()">
                </div>
                <div class="form-group">
                    <label>Amount (₹)</label>
                    <input type="number" placeholder="0" onchange="calculateRecurringTotals()">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select onchange="calculateRecurringTotals()">
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="semi-annually">Semi-Annually</option>
                        <option value="annually">Annually</option>
                    </select>
                </div>
                <button class="delete-btn" onclick="removeRecurringItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(recurringItem);
            calculateRecurringTotals();
            saveNetWorthData();
        }

        function removeRecurringItem(button) {
            button.closest('.asset-item').remove();
            calculateRecurringTotals();
            saveNetWorthData();
        }

        function calculateRecurringTotals() {
            let totalSIP = 0;
            let totalRD = 0;
            let totalOtherSavings = 0;

            // Calculate SIP total
            const sipItems = document.querySelectorAll('#sipItems .asset-item');
            sipItems.forEach(item => {
                const amount = parseFloat(item.querySelectorAll('input')[1].value) || 0;
                const frequency = item.querySelector('select').value;
                const monthlyAmount = convertToMonthly(amount, frequency);
                totalSIP += monthlyAmount;
            });

            // Calculate RD total
            const rdItems = document.querySelectorAll('#rdItems .asset-item');
            rdItems.forEach(item => {
                const amount = parseFloat(item.querySelectorAll('input')[1].value) || 0;
                const frequency = item.querySelector('select').value;
                const monthlyAmount = convertToMonthly(amount, frequency);
                totalRD += monthlyAmount;
            });

            // Calculate Other Savings total
            const otherSavingsItems = document.querySelectorAll('#otherSavingsItems .asset-item');
            otherSavingsItems.forEach(item => {
                const amount = parseFloat(item.querySelectorAll('input')[1].value) || 0;
                const frequency = item.querySelector('select').value;
                const monthlyAmount = convertToMonthly(amount, frequency);
                totalOtherSavings += monthlyAmount;
            });

            // Update individual totals
            document.getElementById('sipTotal').textContent = `₹${totalSIP.toLocaleString('en-IN')}/month`;
            document.getElementById('rdTotal').textContent = `₹${totalRD.toLocaleString('en-IN')}/month`;
            document.getElementById('otherSavingsTotal').textContent = `₹${totalOtherSavings.toLocaleString('en-IN')}/month`;

            // Update summary cards
            document.getElementById('totalSIP').textContent = `₹${totalSIP.toLocaleString('en-IN')}`;
            document.getElementById('totalRD').textContent = `₹${totalRD.toLocaleString('en-IN')}`;
            document.getElementById('totalOtherSavings').textContent = `₹${totalOtherSavings.toLocaleString('en-IN')}`;

            // Calculate and update total monthly recurring savings
            const totalRecurringSavings = totalSIP + totalRD + totalOtherSavings;
            document.getElementById('totalRecurringSavings').textContent = `₹${totalRecurringSavings.toLocaleString('en-IN')}`;

            // Auto-save
            setTimeout(() => {
                saveNetWorthData();
            }, 1000);
        }

        function convertToMonthly(amount, frequency) {
            switch(frequency) {
                case 'monthly': return amount;
                case 'quarterly': return amount / 3;
                case 'semi-annually': return amount / 6;
                case 'annually': return amount / 12;
                default: return amount;
            }
        }

        // Calculate real estate value from price per sq ft and area
        function calculateRealEstateValue(input) {
            const assetItem = input.closest('.asset-item');
            const inputs = assetItem.querySelectorAll('input');
            
            const pricePerSqFt = parseFloat(inputs[1].value) || 0; // Current Price per Sq Ft
            const totalArea = parseFloat(inputs[2].value) || 0;     // Total Area
            const currentValue = pricePerSqFt * totalArea;
            
            inputs[3].value = currentValue; // Set Current Value
            updateWords(inputs[3]); // Update words display
            
            // Trigger totals calculation immediately
            calculateTotals();
        }

        // Calculate rental yield from rental amount and frequency
        function calculateRentalYield(input) {
            const assetItem = input.closest('.asset-item');
            const inputs = assetItem.querySelectorAll('input');
            const select = assetItem.querySelector('select');
            
            const currentValue = parseFloat(inputs[3].value) || 0;  // Current Value
            const rentalAmount = parseFloat(inputs[4].value) || 0;  // Monthly Rental
            const frequency = select.value;
            
            if (currentValue > 0 && rentalAmount > 0) {
                let annualRental = 0;
                
                switch(frequency) {
                    case 'monthly':
                        annualRental = rentalAmount * 12;
                        break;
                    case 'quarterly':
                        annualRental = rentalAmount * 4;
                        break;
                    case 'semi-annually':
                        annualRental = rentalAmount * 2;
                        break;
                    case 'annually':
                        annualRental = rentalAmount;
                        break;
                    default:
                        annualRental = rentalAmount * 12;
                }
                
                const yieldPercentage = (annualRental / currentValue) * 100;
                inputs[6].value = yieldPercentage.toFixed(2); // Set Annual Yield %
            } else {
                inputs[6].value = 0;
            }
            
            // Trigger totals calculation
            calculateTotals();
        }

        // Calculate and save asset-based income
        function calculateAssetIncome() {
            let totalRentalIncome = 0;
            let totalDividendIncome = 0;
            let totalInterestIncome = 0;
            
            // Calculate rental income from real estate
            const realEstateItems = document.querySelectorAll('#realEstateItems .asset-item');
            realEstateItems.forEach(item => {
                const inputs = item.querySelectorAll('input');
                const select = item.querySelector('select');
                const rentalAmount = parseFloat(inputs[4]?.value) || 0;
                const frequency = select?.value || 'monthly';
                
                if (rentalAmount > 0) {
                    let monthlyRental = 0;
                    switch(frequency) {
                        case 'monthly':
                            monthlyRental = rentalAmount;
                            break;
                        case 'quarterly':
                            monthlyRental = rentalAmount / 3;
                            break;
                        case 'semi-annually':
                            monthlyRental = rentalAmount / 6;
                            break;
                        case 'annually':
                            monthlyRental = rentalAmount / 12;
                            break;
                        default:
                            monthlyRental = rentalAmount;
                    }
                    totalRentalIncome += monthlyRental;
                }
            });
            
            // Calculate dividend income from equity
            const equityItems = document.querySelectorAll('#equityItems .asset-item');
            equityItems.forEach(item => {
                const inputs = item.querySelectorAll('input');
                const currentValue = parseFloat(inputs[1]?.value) || 0;
                const dividendYield = parseFloat(inputs[2]?.value) || 0;
                
                if (currentValue > 0 && dividendYield > 0) {
                    const annualDividend = (currentValue * dividendYield) / 100;
                    totalDividendIncome += annualDividend / 12; // Convert to monthly
                }
            });
            
            // Calculate interest income from fixed income
            const fixedIncomeItems = document.querySelectorAll('#fixedIncomeItems .asset-item');
            fixedIncomeItems.forEach(item => {
                const inputs = item.querySelectorAll('input');
                const currentValue = parseFloat(inputs[1]?.value) || 0;
                const interestRate = parseFloat(inputs[2]?.value) || 0;
                
                if (currentValue > 0 && interestRate > 0) {
                    const annualInterest = (currentValue * interestRate) / 100;
                    totalInterestIncome += annualInterest / 12; // Convert to monthly
                }
            });
            
            // Calculate interest income from cash & bank
            const cashItems = document.querySelectorAll('#cashItems .asset-item');
            cashItems.forEach(item => {
                const inputs = item.querySelectorAll('input');
                const currentValue = parseFloat(inputs[1]?.value) || 0;
                const interestRate = parseFloat(inputs[2]?.value) || 0;
                
                if (currentValue > 0 && interestRate > 0) {
                    const annualInterest = (currentValue * interestRate) / 100;
                    totalInterestIncome += annualInterest / 12; // Convert to monthly
                }
            });
            
            // Save asset income data
            const assetIncomeData = {
                rentalIncome: totalRentalIncome * 12, // Store as annual
                dividendIncome: totalDividendIncome * 12, // Store as annual
                interestIncome: totalInterestIncome * 12, // Store as annual
                lastUpdated: Date.now()
            };
            
            localStorage.setItem('assetIncomeData', JSON.stringify(assetIncomeData));
            
            return assetIncomeData;
        }

        function goNext() {
            saveNetWorthData();
            calculateAssetIncome(); // Calculate asset-based income
            showStatus('Net worth data saved successfully!');
            setTimeout(() => {
                window.location.href = 'income.html';
            }, 1500);
        }
    </script>
    
    <!-- Include Chat Widget -->
    <script>
        fetch('chat-widget.html')
            .then(response => response.text())
            .then(html => {
                document.body.insertAdjacentHTML('beforeend', html);
            })
            .catch(error => console.log('Chat widget not available'));
    </script>
</body>
</html> 