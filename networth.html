<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Net Worth - Nivezo</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --bg-primary: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --success-color: #22c55e;
            --bg-secondary: #f8fafc;
            --border-color: #e2e8f0;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--bg-secondary);
        }

        .container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .navbar {
            background-color: var(--bg-primary);
            padding: 1rem 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .page-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .instruction-box {
            background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            border: 1px solid #0ea5e9;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .instruction-box h3 {
            color: #0369a1;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .summary-card {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
            text-align: center;
        }

        .summary-card.assets {
            border-left: 4px solid var(--success-color);
        }

        .summary-card.liabilities {
            border-left: 4px solid var(--danger-color);
        }

        .summary-card.networth {
            border-left: 4px solid var(--primary-color);
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        }

        .summary-amount {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .summary-amount.positive {
            color: var(--success-color);
        }

        .summary-amount.negative {
            color: var(--danger-color);
        }

        .summary-amount.networth {
            color: var(--primary-color);
        }

        .section-card {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .add-item-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .add-item-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .category-group {
            margin-bottom: 2rem;
        }

        .category-header {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        .category-total {
            font-weight: 700;
            color: var(--primary-color);
        }

        .asset-item {
            background: #fafafa;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: grid;
            grid-template-columns: 2fr 1fr 1fr auto;
            gap: 1rem;
            align-items: center;
        }

        .form-group {
            margin-bottom: 0;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.25rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            font-size: 0.9rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .amount-display {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .delete-btn {
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 0.375rem;
            border-radius: 0.375rem;
            cursor: pointer;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-btn:hover {
            background: #dc2626;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .nav-btn {
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            font-size: 1rem;
            min-width: 150px;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: var(--text-primary);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-email {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .status-message {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            color: white;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .status-message.success {
            background-color: var(--success-color);
        }

        .status-message.error {
            background-color: var(--danger-color);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .asset-item {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .navigation {
                flex-direction: column;
                gap: 1rem;
            }
            
            .nav-btn {
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="nav-brand" style="text-decoration: none;">Nivezo</a>
            <div class="user-info">
                <span class="user-email" id="userEmail"></span>
                <button class="btn btn-secondary" onclick="handleLogout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1><i class="fas fa-chart-line"></i> Net Worth Analysis</h1>
            <p>Track your assets and liabilities to calculate your true net worth</p>
        </div>

        <!-- Page Description -->
        <div class="page-description" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
            <h3 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem;">
                <i class="fas fa-info-circle" style="color: var(--primary-color);"></i>
                About This Section
            </h3>
            <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                Net worth is a snapshot of your overall financial health. It is calculated as everything you own (assets) minus everything you owe (liabilities). This one number tells you if you are moving in the right direction financially.
            </p>
            <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1rem;">
                If your net worth grows year after year, it means your wealth is compounding. If it's declining, it's a signal that expenses or debt may be outpacing your income or savings.
            </p>
            <div style="background: #e0f2fe; border-radius: 8px; padding: 1rem; border-left: 4px solid var(--primary-color);">
                <strong style="color: var(--primary-color);">How to go about it:</strong>
                <span style="color: #0c4a6e;"> Add details about your bank balance, investments, gold, property, and vehicles. Then include your loans and credit dues. This gives you the clearest possible view of your actual financial position.</span>
            </div>
        </div>

        <!-- Instruction Box -->
        <div class="instruction-box">
            <h3><i class="fas fa-info-circle"></i> Important Note</h3>
            <p>% Yield represents the annual income you generate or expect to generate from each asset, excluding asset appreciation. For example, rental income from real estate, dividends from equity, or interest from fixed deposits.</p>
        </div>

        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card assets">
                <h3>Total Assets</h3>
                <div class="summary-amount positive" id="totalAssets">‚Çπ0</div>
                <small>Excluding occupied house & ornaments</small>
            </div>
            <div class="summary-card liabilities">
                <h3>Total Liabilities</h3>
                <div class="summary-amount negative" id="totalLiabilities">‚Çπ0</div>
                <small>Remaining principal amounts</small>
            </div>
            <div class="summary-card networth">
                <h3>Net Worth</h3>
                <div class="summary-amount networth" id="netWorth">‚Çπ0</div>
                <small>Assets - Liabilities</small>
            </div>
        </div>

        <!-- Assets Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-building"></i> Assets
                </h2>
            </div>

            <!-- Real Estate -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">üè† Real Estate</span>
                    <span class="category-total" id="realEstateTotal">‚Çπ0</span>
                </div>
                <div id="realEstateItems">
                    <!-- Real estate items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('realEstate', 'Real Estate')">
                    <i class="fas fa-plus"></i> Add Real Estate
                </button>
            </div>

            <!-- Equity Investments -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">üìà Equity Investments</span>
                    <span class="category-total" id="equityTotal">‚Çπ0</span>
                </div>
                <div id="equityItems">
                    <!-- Equity items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('equity', 'Equity')">
                    <i class="fas fa-plus"></i> Add Equity Investment
                </button>
            </div>

            <!-- Fixed Income -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">üè¶ Fixed Income</span>
                    <span class="category-total" id="fixedIncomeTotal">‚Çπ0</span>
                </div>
                <div id="fixedIncomeItems">
                    <!-- Fixed income items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('fixedIncome', 'Fixed Income')">
                    <i class="fas fa-plus"></i> Add Fixed Income
                </button>
            </div>

            <!-- Other Assets -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">üíé Other Assets</span>
                    <span class="category-total" id="otherAssetsTotal">‚Çπ0</span>
                </div>
                <div id="otherAssetsItems">
                    <!-- Other assets items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addAssetItem('otherAssets', 'Other Asset')">
                    <i class="fas fa-plus"></i> Add Other Asset
                </button>
            </div>
        </div>

        <!-- Liabilities Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-credit-card"></i> Liabilities
                </h2>
            </div>

            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">üí≥ Loans & Debts</span>
                    <span class="category-total" id="liabilitiesTotal">‚Çπ0</span>
                </div>
                <div id="liabilityItems">
                    <!-- Liability items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addLiabilityItem()">
                    <i class="fas fa-plus"></i> Add Liability
                </button>
            </div>
        </div>

        <!-- Recurring Investments Section -->
        <div class="section-card">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-sync-alt"></i> Recurring Investments & Savings
                </h2>
                <small class="text-secondary">Track your regular monthly investments and savings</small>
            </div>

            <!-- Monthly Recurring Summary -->
            <div class="summary-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr; margin-bottom: 2rem;">
                <div class="summary-card assets">
                    <h3>Total SIP</h3>
                    <div class="summary-amount positive" id="totalSIP">‚Çπ0</div>
                    <small>Monthly SIP amount</small>
                </div>
                <div class="summary-card networth">
                    <h3>Total RD/FD</h3>
                    <div class="summary-amount networth" id="totalRD">‚Çπ0</div>
                    <small>Monthly recurring deposits</small>
                </div>
                <div class="summary-card liabilities">
                    <h3>Other Savings</h3>
                    <div class="summary-amount negative" id="totalOtherSavings">‚Çπ0</div>
                    <small>Monthly other schemes</small>
                </div>
                <div class="summary-card">
                    <h3>Total Monthly</h3>
                    <div class="summary-amount" id="totalRecurringSavings">‚Çπ0</div>
                    <small>Combined monthly savings</small>
                </div>
            </div>

            <!-- Mutual Fund SIP -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">üìà Mutual Fund SIP</span>
                    <span class="category-total" id="sipTotal">‚Çπ0/month</span>
                </div>
                <div id="sipItems">
                    <!-- SIP items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addRecurringItem('sip', 'Mutual Fund SIP')">
                    <i class="fas fa-plus"></i> Add SIP
                </button>
            </div>

            <!-- Recurring FD/RD -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">üè¶ Recurring Deposits</span>
                    <span class="category-total" id="rdTotal">‚Çπ0/month</span>
                </div>
                <div id="rdItems">
                    <!-- RD items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addRecurringItem('rd', 'Recurring Deposit')">
                    <i class="fas fa-plus"></i> Add Recurring Deposit
                </button>
            </div>

            <!-- Other Savings Schemes -->
            <div class="category-group">
                <div class="category-header">
                    <span class="category-title">üí∞ Other Savings Schemes</span>
                    <span class="category-total" id="otherSavingsTotal">‚Çπ0/month</span>
                </div>
                <div class="instruction-box">
                    <p><strong>Examples:</strong> PF, PPF, ELSS, NSC, Life Insurance Premiums, Gold SIP, or any regular investment</p>
                </div>
                <div id="otherSavingsItems">
                    <!-- Other savings items will be added here -->
                </div>
                <button class="add-item-btn" onclick="addRecurringItem('otherSavings', 'Savings Scheme')">
                    <i class="fas fa-plus"></i> Add Savings Scheme
                </button>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation">
            <button type="button" class="nav-btn btn-secondary" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Back: Personal Info
            </button>
            <button type="button" class="nav-btn btn-primary" onclick="goNext()">
                Next: Income Analysis <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- Status Message -->
    <div id="status" class="status-message" style="display: none;"></div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.8.1/firebase-auth-compat.js"></script>
    <script src="auth.js"></script>
    <script src="common.js"></script>

    <script>
        let assetCount = 0;
        let liabilityCount = 0;

        // Check authentication
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('userEmail').textContent = user.email;
                loadNetWorthData();
                
                // Setup navigation system
                if (typeof setupPageNavigation === 'function') {
                    setupPageNavigation(2); // 2 = Net Worth page
                }
            } else {
                window.location.href = 'index.html';
            }
        });

        function showStatus(message, isError = false) {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status-message ${isError ? 'error' : 'success'}`;
            statusElement.style.display = 'block';
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }

        function numberToWords(num) {
            if (num === 0) return "Zero";
            
            const ones = ["", "One", "Two", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine"];
            const teens = ["Ten", "Eleven", "Twelve", "Thirteen", "Fourteen", "Fifteen", "Sixteen", "Seventeen", "Eighteen", "Nineteen"];
            const tens = ["", "", "Twenty", "Thirty", "Forty", "Fifty", "Sixty", "Seventy", "Eighty", "Ninety"];
            
            function convertHundreds(n) {
                let result = "";
                if (n >= 100) {
                    result += ones[Math.floor(n / 100)] + " Hundred ";
                    n %= 100;
                }
                if (n >= 20) {
                    result += tens[Math.floor(n / 10)] + " ";
                    n %= 10;
                }
                if (n >= 10) {
                    result += teens[n - 10] + " ";
                } else if (n > 0) {
                    result += ones[n] + " ";
                }
                return result;
            }
            
            if (num >= 10000000) { // Crores
                return convertHundreds(Math.floor(num / 10000000)) + "Crore " + numberToWords(num % 10000000);
            } else if (num >= 100000) { // Lakhs
                return convertHundreds(Math.floor(num / 100000)) + "Lakh " + numberToWords(num % 100000);
            } else if (num >= 1000) { // Thousands
                return convertHundreds(Math.floor(num / 1000)) + "Thousand " + numberToWords(num % 1000);
            } else {
                return convertHundreds(num);
            }
        }

        function addAssetItem(category, type) {
            assetCount++;
            const container = document.getElementById(category + 'Items');
            const assetItem = document.createElement('div');
            assetItem.className = 'asset-item';
            assetItem.innerHTML = `
                <div class="form-group">
                    <label>${type} Name</label>
                    <input type="text" placeholder="Enter name" onchange="calculateTotals()">
                    <div class="amount-display"></div>
                </div>
                <div class="form-group">
                    <label>Value (‚Çπ)</label>
                    <input type="number" placeholder="0" onchange="calculateTotals(); updateWords(this)">
                    <div class="amount-display"></div>
                </div>
                <div class="form-group">
                    <label>Yield (%)</label>
                    <input type="number" step="0.1" placeholder="0" onchange="calculateTotals()">
                    <div class="amount-display"></div>
                </div>
                <button class="delete-btn" onclick="removeItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(assetItem);
            saveNetWorthData();
        }

        function addLiabilityItem() {
            liabilityCount++;
            const container = document.getElementById('liabilityItems');
            const liabilityItem = document.createElement('div');
            liabilityItem.className = 'asset-item';
            liabilityItem.innerHTML = `
                <div class="form-group">
                    <label>Loan Type</label>
                    <select onchange="calculateTotals()">
                        <option value="">Select Type</option>
                        <option value="home">Home Loan</option>
                        <option value="car">Car Loan</option>
                        <option value="education">Education Loan</option>
                        <option value="personal">Personal Loan</option>
                        <option value="credit">Credit Card</option>
                        <option value="business">Business Loan</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Remaining Amount (‚Çπ)</label>
                    <input type="number" placeholder="0" onchange="calculateTotals(); updateWords(this)">
                    <div class="amount-display"></div>
                </div>
                <div class="form-group">
                    <label>Remaining Tenure (Months)</label>
                    <input type="number" placeholder="0" onchange="calculateTotals()">
                </div>
                <button class="delete-btn" onclick="removeItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(liabilityItem);
            saveNetWorthData();
        }

        function removeItem(button) {
            button.closest('.asset-item').remove();
            calculateTotals();
            saveNetWorthData();
        }

        function updateWords(input) {
            const value = parseFloat(input.value) || 0;
            const wordsDiv = input.nextElementSibling;
            if (wordsDiv && wordsDiv.classList.contains('amount-display')) {
                wordsDiv.textContent = value > 0 ? numberToWords(value) : '';
            }
        }

        function calculateTotals() {
            let totalAssets = 0;
            let totalLiabilities = 0;
            let liquidAssets = 0;
            
            // Calculate category totals
            const categories = ['realEstate', 'equity', 'fixedIncome', 'otherAssets'];
            categories.forEach(category => {
                let categoryTotal = 0;
                const items = document.querySelectorAll(`#${category}Items .asset-item`);
                items.forEach(item => {
                    const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
                    categoryTotal += value;
                    
                    // All assets contribute to total assets
                    totalAssets += value;
                    
                    // Real estate and other assets (like occupied house) are illiquid
                    if (category !== 'realEstate' && category !== 'otherAssets') {
                        liquidAssets += value;
                    }
                });
                document.getElementById(category + 'Total').textContent = `‚Çπ${categoryTotal.toLocaleString('en-IN')}`;
            });

            // Calculate liabilities
            const liabilityItems = document.querySelectorAll('#liabilityItems .asset-item');
            liabilityItems.forEach(item => {
                const value = parseFloat(item.querySelector('input[type="number"]').value) || 0;
                totalLiabilities += value;
            });

            // Update totals display
            document.getElementById('totalAssets').textContent = `‚Çπ${totalAssets.toLocaleString('en-IN')}`;
            document.getElementById('totalLiabilities').textContent = `‚Çπ${totalLiabilities.toLocaleString('en-IN')}`;
            document.getElementById('liabilitiesTotal').textContent = `‚Çπ${totalLiabilities.toLocaleString('en-IN')}`;
            
            const netWorth = totalAssets - totalLiabilities;
            const liquidNetWorth = liquidAssets - totalLiabilities;
            
            document.getElementById('netWorth').textContent = `‚Çπ${netWorth.toLocaleString('en-IN')}`;
            
            // Display liquid net worth if element exists
            const liquidNetWorthElement = document.getElementById('liquidNetWorth');
            if (liquidNetWorthElement) {
                liquidNetWorthElement.textContent = `‚Çπ${liquidNetWorth.toLocaleString('en-IN')}`;
            }

            // Auto-save
            setTimeout(() => {
                saveNetWorthData();
            }, 1000);
        }

        function saveNetWorthData() {
            const data = {
                assets: {},
                liabilities: [],
                recurringInvestments: {
                    sip: [],
                    rd: [],
                    otherSavings: []
                },
                totals: {
                    totalAssets: parseFloat(document.getElementById('totalAssets').textContent.replace(/[‚Çπ,]/g, '')) || 0,
                    totalLiabilities: parseFloat(document.getElementById('totalLiabilities').textContent.replace(/[‚Çπ,]/g, '')) || 0,
                    netWorth: parseFloat(document.getElementById('netWorth').textContent.replace(/[‚Çπ,]/g, '')) || 0,
                    totalRecurringSavings: parseFloat(document.getElementById('totalRecurringSavings').textContent.replace(/[‚Çπ,]/g, '')) || 0
                }
            };

            // Calculate liquid assets (excluding real estate and other assets)
            let liquidAssets = 0;
            const liquidCategories = ['equity', 'fixedIncome'];
            
            // Save assets by category
            const categories = ['realEstate', 'equity', 'fixedIncome', 'otherAssets'];
            categories.forEach(category => {
                data.assets[category] = [];
                const items = document.querySelectorAll(`#${category}Items .asset-item`);
                items.forEach(item => {
                    const inputs = item.querySelectorAll('input');
                    if (inputs.length >= 3) {
                        const assetValue = parseFloat(inputs[1].value) || 0;
                        data.assets[category].push({
                            name: inputs[0].value,
                            value: assetValue,
                            yield: parseFloat(inputs[2].value) || 0
                        });
                        
                        // Add to liquid assets if it's a liquid category
                        if (liquidCategories.includes(category)) {
                            liquidAssets += assetValue;
                        }
                    }
                });
            });

            // Save liabilities
            const liabilityItems = document.querySelectorAll('#liabilityItems .asset-item');
            liabilityItems.forEach(item => {
                const select = item.querySelector('select');
                const inputs = item.querySelectorAll('input');
                if (inputs.length >= 2) {
                    data.liabilities.push({
                        type: select.value,
                        amount: parseFloat(inputs[0].value) || 0,
                        tenure: parseFloat(inputs[1].value) || 0
                    });
                }
            });

            // Save recurring investments
            const recurringCategories = ['sip', 'rd', 'otherSavings'];
            recurringCategories.forEach(category => {
                const items = document.querySelectorAll(`#${category}Items .asset-item`);
                items.forEach(item => {
                    const inputs = item.querySelectorAll('input');
                    const select = item.querySelector('select');
                    if (inputs.length >= 2) {
                        data.recurringInvestments[category].push({
                            name: inputs[0].value,
                            amount: parseFloat(inputs[1].value) || 0,
                            frequency: select.value
                        });
                    }
                });
            });

            // Add liquid net worth to totals
            data.totals.liquidNetWorth = liquidAssets - data.totals.totalLiabilities;

            localStorage.setItem('netWorthData', JSON.stringify(data));
        }

        function loadNetWorthData() {
            const savedData = localStorage.getItem('netWorthData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Load assets
                Object.keys(data.assets || {}).forEach(category => {
                    data.assets[category].forEach(asset => {
                        addAssetItem(category, category === 'realEstate' ? 'Real Estate' : 
                                   category === 'equity' ? 'Equity' : 
                                   category === 'fixedIncome' ? 'Fixed Income' : 'Other Asset');
                        
                        const lastItem = document.querySelector(`#${category}Items .asset-item:last-child`);
                        const inputs = lastItem.querySelectorAll('input');
                        inputs[0].value = asset.name;
                        inputs[1].value = asset.value;
                        inputs[2].value = asset.yield;
                        updateWords(inputs[1]);
                    });
                });

                // Load liabilities
                (data.liabilities || []).forEach(liability => {
                    addLiabilityItem();
                    const lastItem = document.querySelector('#liabilityItems .asset-item:last-child');
                    const select = lastItem.querySelector('select');
                    const inputs = lastItem.querySelectorAll('input');
                    select.value = liability.type;
                    inputs[0].value = liability.amount;
                    inputs[1].value = liability.tenure;
                    updateWords(inputs[0]);
                });

                // Load recurring investments
                const recurringData = data.recurringInvestments || {};
                Object.keys(recurringData).forEach(category => {
                    if (recurringData[category]) {
                        recurringData[category].forEach(item => {
                            const categoryName = category === 'sip' ? 'Mutual Fund SIP' : 
                                                category === 'rd' ? 'Recurring Deposit' : 'Savings Scheme';
                            addRecurringItem(category, categoryName);
                            
                            const lastItem = document.querySelector(`#${category}Items .asset-item:last-child`);
                            const inputs = lastItem.querySelectorAll('input');
                            const select = lastItem.querySelector('select');
                            inputs[0].value = item.name || '';
                            inputs[1].value = item.amount || 0;
                            select.value = item.frequency || 'monthly';
                        });
                    }
                });

                calculateTotals();
                calculateRecurringTotals();
            }
        }

        function goBack() {
            window.location.href = 'personal-info.html';
        }

        // Recurring investments functions
        let recurringCount = 0;

        function addRecurringItem(category, type) {
            recurringCount++;
            const container = document.getElementById(category + 'Items');
            const recurringItem = document.createElement('div');
            recurringItem.className = 'asset-item';
            recurringItem.innerHTML = `
                <div class="form-group">
                    <label>${type} Name/Scheme</label>
                    <input type="text" placeholder="Enter scheme name" onchange="calculateRecurringTotals()">
                </div>
                <div class="form-group">
                    <label>Amount (‚Çπ)</label>
                    <input type="number" placeholder="0" onchange="calculateRecurringTotals()">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select onchange="calculateRecurringTotals()">
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="semi-annually">Semi-Annually</option>
                        <option value="annually">Annually</option>
                    </select>
                </div>
                <button class="delete-btn" onclick="removeRecurringItem(this)">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            container.appendChild(recurringItem);
            calculateRecurringTotals();
            saveNetWorthData();
        }

        function removeRecurringItem(button) {
            button.closest('.asset-item').remove();
            calculateRecurringTotals();
            saveNetWorthData();
        }

        function calculateRecurringTotals() {
            let totalSIP = 0;
            let totalRD = 0;
            let totalOtherSavings = 0;

            // Calculate SIP total
            const sipItems = document.querySelectorAll('#sipItems .asset-item');
            sipItems.forEach(item => {
                const amount = parseFloat(item.querySelectorAll('input')[1].value) || 0;
                const frequency = item.querySelector('select').value;
                const monthlyAmount = convertToMonthly(amount, frequency);
                totalSIP += monthlyAmount;
            });

            // Calculate RD total
            const rdItems = document.querySelectorAll('#rdItems .asset-item');
            rdItems.forEach(item => {
                const amount = parseFloat(item.querySelectorAll('input')[1].value) || 0;
                const frequency = item.querySelector('select').value;
                const monthlyAmount = convertToMonthly(amount, frequency);
                totalRD += monthlyAmount;
            });

            // Calculate Other Savings total
            const otherSavingsItems = document.querySelectorAll('#otherSavingsItems .asset-item');
            otherSavingsItems.forEach(item => {
                const amount = parseFloat(item.querySelectorAll('input')[1].value) || 0;
                const frequency = item.querySelector('select').value;
                const monthlyAmount = convertToMonthly(amount, frequency);
                totalOtherSavings += monthlyAmount;
            });

            // Update individual totals
            document.getElementById('sipTotal').textContent = `‚Çπ${totalSIP.toLocaleString('en-IN')}/month`;
            document.getElementById('rdTotal').textContent = `‚Çπ${totalRD.toLocaleString('en-IN')}/month`;
            document.getElementById('otherSavingsTotal').textContent = `‚Çπ${totalOtherSavings.toLocaleString('en-IN')}/month`;

            // Update summary cards
            document.getElementById('totalSIP').textContent = `‚Çπ${totalSIP.toLocaleString('en-IN')}`;
            document.getElementById('totalRD').textContent = `‚Çπ${totalRD.toLocaleString('en-IN')}`;
            document.getElementById('totalOtherSavings').textContent = `‚Çπ${totalOtherSavings.toLocaleString('en-IN')}`;

            // Calculate and update total monthly recurring savings
            const totalRecurringSavings = totalSIP + totalRD + totalOtherSavings;
            document.getElementById('totalRecurringSavings').textContent = `‚Çπ${totalRecurringSavings.toLocaleString('en-IN')}`;

            // Auto-save
            setTimeout(() => {
                saveNetWorthData();
            }, 1000);
        }

        function convertToMonthly(amount, frequency) {
            switch(frequency) {
                case 'monthly': return amount;
                case 'quarterly': return amount / 3;
                case 'semi-annually': return amount / 6;
                case 'annually': return amount / 12;
                default: return amount;
            }
        }

        function goNext() {
            saveNetWorthData();
            showStatus('Net worth data saved successfully!');
            setTimeout(() => {
                window.location.href = 'income.html';
            }, 1500);
        }
    </script>
</body>
</html> 